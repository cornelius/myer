#!/usr/bin/env ruby

require 'gli'

require_relative '../lib/myer'

include GLI::App

program_desc 'Command line client for Project MySelf'

version Myer::VERSION

subcommand_option_handling :normal
arguments :strict

desc 'Describe some switch here'
switch [:s,:switch]

desc 'Describe some flag here'
default_value 'the default'
arg_name 'The name of the argument'
flag [:f,:flagname]

pre do |global,command,options,args|
  # Pre logic here
  # Return true to proceed; false to abort and not call the
  # chosen command
  # Use skips_pre before a command to skip this block
  # on that command only
  true
end

post do |global,command,options,args|
  # Post logic here
  # Use skips_post before a command to skip this
  # block on that command only
end

on_error do |exception|
  # Error logic here
  # return false to skip default error handling
  true
end

desc "Admin actions"
command :admin do |c|
  c.desc "Register client"
  c.arg :server
  c.arg :pin
  c.command :register do |register|
    register.action do |g, o, args|
      if args.length < 2
        raise "You must specifcy server and pid"
      end
      AdminCliController.new.register(args[0], args[1])
    end
  end
end

desc "Track mouse clicks"
command :track_clicks do |c|
  c.action do
    CliController.new.track_clicks
  end
end

exit run(ARGV)
